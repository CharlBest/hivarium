<div *ngIf="campaign !== null && campaign !== undefined">
    <mat-card>
        <app-media [src]="campaign.campaign.media"
            mat-card-image></app-media>

        <mat-card-title>{{campaign.campaign.title}}</mat-card-title>
        <mat-card-content>
            <div>{{campaign.campaign.description}}</div>
            <br>
            <a routerLink="/user/{{campaign.owner.id}}"
                style="color: black; text-decoration: none;">by
                <strong>{{campaign.owner.username}}</strong>
            </a>
            <br>
            <br>
            <div>
                <div style="float: left; margin-right: 20px;">
                    <div>
                        <strong>{{campaign.milestonesReached}}</strong> of
                        <strong>{{campaign.milestones.length}}</strong>
                    </div>
                    <div>milestones</div>
                </div>
                <div style="float: left; margin-right: 20px;">
                    <div>
                        <strong>{{campaign.totalAmountSold}}</strong> of
                        <strong>{{campaign.totalAvailableProducts}}</strong>
                    </div>
                    <div>sold</div>
                </div>
                <div style="float: left;">
                    <div>
                        <strong>{{campaign.campaign.daysRemaining}}</strong>
                    </div>
                    <div>days to go</div>
                </div>
                <div style="clear: both;"></div>
            </div>

            <hr>

            <table style="text-align: center; width: 100%;">
                <tbody>
                    <tr>
                        <td>
                            Earn
                            <br>
                            <span *ngIf="campaign.minimumMilestoneReward !== campaign.maximumMilestoneReward">
                                <img src="assets/hive-coin.svg"
                                    style="max-height: 12px;"> {{campaign.minimumMilestoneReward}} to
                            </span>
                            <img src="assets/hive-coin.svg"
                                style="max-height: 12px;"> {{campaign.maximumMilestoneReward}}
                            <br> when making a
                            <br> purchase
                        </td>
                        <td>
                            Give and Get
                            <br>
                            <span *ngIf="campaign.minimumReferralReward !== campaign.maximumReferralReward">
                                <img src="assets/hive-coin.svg"
                                    style="max-height: 12px;"> {{campaign.minimumReferralReward}} to
                            </span>
                            <img src="assets/hive-coin.svg"
                                style="max-height: 12px;"> {{campaign.maximumReferralReward}}
                            <br> when referring a
                            <br> friend to make
                            <br> a purchase
                        </td>
                    </tr>
                    <tr style="color: lightgrey;">
                        <td>
                            <mat-icon>shopping_cart</mat-icon>
                        </td>
                        <td>
                            <mat-icon>person_add</mat-icon>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <button mat-raised-button
                                type="button"
                                color="primary"
                                (click)="buyNowButton()">Buy now</button>
                        </td>
                        <td>
                            <button mat-raised-button
                                type="button"
                                color="primary"
                                (click)="goToRefferalSection()">Refer a friend</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </mat-card-content>
    </mat-card>
    <mat-tab-group [(selectedIndex)]="selectedTab"
        id="app-tab-group">
        <mat-tab>
            <ng-template mat-tab-label>Rewards</ng-template>
            <mat-card>
                <mat-card-content>
                    <h3 style="text-align: center;">Milestone HiveCoin Rewards</h3>
                    <mat-progress-bar [value]="campaign.percentageOfTopMilestoneReached"></mat-progress-bar>
                    <br>
                    <div style="text-align: center;">Value of Sales:
                        <strong>${{campaign.totalValueOfSales}}</strong>
                    </div>
                    <br>

                    <table style="width: 100%;">
                        <tbody>
                            <tr *ngFor="let milestone of campaign.milestones; let i=index">
                                <td style="vertical-align: top; padding-top: 24px;">
                                    <img src="assets/hive-coin.svg"
                                        style="max-height: 40px;"
                                        [class.svg-greyscale]="milestone.unlockAtValueOfSales > campaign.totalValueOfSales">
                                </td>
                                <td>
                                    <h4>Milestone {{i+1}}</h4>
                                    <div>Unloacked at: ${{milestone.unlockAtValueOfSales}}</div>
                                    <div>
                                        Earn
                                        <strong>{{milestone.percentageDiscount}}%</strong>
                                        of your purchase back in HiveCoins
                                    </div>
                                </td>
                                <td style="font-size: 2rem; border-left: 1px solid lightgray; text-align: center;">
                                    {{milestone.percentageDiscount}}%
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </mat-card-content>
            </mat-card>
            <mat-card>
                <mat-card-content>
                    <h3 style="text-align: center;">Referral HiveCoin Rewards</h3>
                    <app-referral-rewards [campaign]="campaign"></app-referral-rewards>
                </mat-card-content>
            </mat-card>
        </mat-tab>
        <mat-tab>
            <ng-template mat-tab-label>Buy</ng-template>
            <mat-card *ngIf="campaign.refUsername && loggedInUsername !== campaign.refUsername">
                <mat-card-content style="text-align: center;">
                    <h4>You've been referred by {{campaign.refUsername}}</h4>
                    <div>Referral bonus HiveCoins Reward unlocked</div>
                </mat-card-content>
            </mat-card>

            <div class="products-container">
                <mat-card *ngFor="let product of campaign.products; let i=index"
                    style="max-width: 380px;">

                    <app-media [src]="product.media"
                        *ngIf="product.media"
                        mat-card-image></app-media>

                    <mat-card-content>
                        <table style="width: 100%; text-align: center; font-size: 2rem;">
                            <tbody>
                                <tr>
                                    <td>
                                        ${{product.cost}}
                                        <span style="font-size: 1rem; color: lightgrey;">USD</span>
                                    </td>
                                    <td style="border-left: 1px solid lightgray;">
                                        <img src="assets/hive-coin.svg"
                                            style="max-height: 22px;"> {{product.cost}}
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <h3>{{product.title}}</h3>
                        <div>{{product.description}}</div>
                        <br>
                        <div>
                            <strong>{{product.sold}}</strong> of
                            <strong>{{product.quantity}}</strong>
                            <br> sold
                        </div>
                        <hr>
                        <h5 style="text-align: center;">HiveCoins Rewards
                            <button mat-icon-button
                                type="button">
                                <mat-icon (click)="openCoinRewardInfoDialog()">info</mat-icon>
                            </button>
                        </h5>

                        <div>
                            <div style="float: left; margin-right: 20px;">
                                <img src="assets/hive-coin.svg"
                                    style="max-height: 12px;"> {{campaign.productMilestoneReward(product.cost)}}
                                <div>milestone reward</div>
                            </div>
                            <div style="float: left; margin-right: 20px;">
                                <img src="assets/hive-coin.svg"
                                    style="max-height: 12px;"
                                    [class.svg-greyscale]="campaign.refUsername === null || (loggedInUsername === campaign.refUsername && campaign.refUsername !== null)"> {{campaign.productReferralReward(product.cost)}}
                                <div>referral reward</div>
                            </div>
                            <div style="float: left;">
                                <img src="assets/hive-coin.svg"
                                    style="max-height: 12px;"
                                    [class.svg-greyscale]="campaign.totalValueOfSales < campaign.milestones[campaign.milestones.length - 1].unlockAtValueOfSales"> {{campaign.productMaxMilestoneReward(product.cost)}}
                                <div>max milestone reward</div>
                            </div>
                        </div>
                        <br>
                        <br>
                    </mat-card-content>
                    <mat-card-actions>
                        <button mat-raised-button
                            type="button"
                            color="primary"
                            (click)="goToProduct(product)"
                            style="width: 100%;">Buy this product</button>
                    </mat-card-actions>
                </mat-card>
            </div>
        </mat-tab>
        <mat-tab>
            <ng-template mat-tab-label>Campaign</ng-template>
            <mat-card>
                <mat-card-content [innerHTML]="campaign.campaign.fullDescription"
                    class="fit-images"></mat-card-content>
            </mat-card>
        </mat-tab>
    </mat-tab-group>
</div>